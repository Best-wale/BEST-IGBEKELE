<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>My Virtual Assistant</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<!-- KaTeX CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">



        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
            crossorigin="anonymous"
        />

        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
        />
        <link
            rel="stylesheet"
            type="text/css"
            media="screen"
            href="style/font.css"
        />
        <link
            rel="stylesheet"
            type="text/css"
            media="screen"
            href="style/main.css"
        />
        <script src="main.js"></script>
    </head>

    <body>
        <div class="container main overflow-none">
            <div
                class="row d-flex flex-row justify-content-between mb-0 pt-3 position-relative"
            >
                <div class="col-10 col-sm-2">
                    <h1 class="logo">B<span>.</span></h1>
                </div>
                <div
                    class="  d-none d-lg-flex d-md-flex d-sm-none col-lg-8 col-md-6 col-sm-1 row align-self-center"
                >
                    <li class="   col-sm-1 col-md-3 col-lg-2">
                        <a class="nav-element " href="index.html">Home</a>
                    </li>
                    <li class="col-sm-1 col-md-3 col-lg-2">
                        <a class="nav-element" href="about.html">About</a>
                    </li>
                    <li class="col-sm-1 col-md-3 col-lg-2">
                        <a class="nav-element" href="work.html">Work</a>
                    </li>
                    <li class="col-sm-1 col-md-3 col-lg-3">
                        <a class="nav-element active" href="chat_bot.html">NexaPrime</a>
                    </li>
                    <li class="col-sm-1 col-md-3 col-lg-3">
                        <a class="nav-element" href="contact.html">Contact</a>
                    </li>
                </div>
                <div
                    class="d-flex d-lg-none d-md-none d-sm-flex col-2 col-sm-2 align-self-center"
                >
                    <i
                        onclick="click_item()"
                        id="menu"
                        class="bi bi-text-indent-left"
                    ></i>
                </div>

                <div
                    class="d-none d-lg-flex d-md-flex d-sm-none col-sm-2 align-self-center"
                >
                    <a href="contact.html" class="theme-btn" id="theme-btn"
                        >Let's talk</a
                    >
                </div>

                <div
                    id="small-item"
                    class="small-item d-flex d-lg-none d-md-none"
                >
                    <ul class="d-flex flex-column col-12 p-4">
                        <li class="clo-12 col-sm-12 text-center mb-5">
                            <a class="nav-element active" href="index.html"
                                >Home</a
                            >
                        </li>
                        <li class="clo-12 col-sm-12 text-center mb-5">
                            <a class="nav-element" href="about.html">About</a>
                        </li>
                        <li class="clo-12 col-sm-12 text-center mb-5">
                            <a class="nav-element" href="work.html">Work</a>
                        </li>
                        <li class="clo-12 col-sm-12 text-center mb-5">
                            <a class="nav-element" href="contact.html"
                                >Contact</a
                            >
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row py-5 vh-70" style="height: 500px">
                <div id='chat' class="  col-lg-12 h-100 overflow-auto">
                    <!--Ai message-->
                    <div  class="col-lg-12 p-2">
                        <div
                            class="shadow-box col-lg-5 p-4 fs-6 lh-base text-break text-wrap"
                        >
                        <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
  <rect x="12" y="16" width="40" height="32" rx="16" fill="#3B82F6"/>
  <circle cx="24" cy="32" r="4" fill="white"/>
  <circle cx="40" cy="32" r="4" fill="white"/>
  <path d="M28 40c2 2 6 2 8 0" stroke="white" stroke-width="2" stroke-linecap="round"/>
  <path d="M32 8v8" stroke="#60A5FA" stroke-width="2" stroke-linecap="round"/>
  <path d="M20 20L16 12M44 20L48 12" stroke="#60A5FA" stroke-width="2" stroke-linecap="round"/>
</svg>

                            Hi, what can i do for u today?
                        </div>
                    </div>

                    <!--Ai message-->


                    
                </div>
                <hr />
                <div class="col-lg-12 h-auto ">
                     <form id="promptForm">
                    <div class="row justify-content-start">
                        <div class="col-10 ">
                           <div class="input-box pb-0">
                           

                            <input id="prompt"
                                type="text"
                                name="name"
                                placeholder="Ask me anything ...."
                                class=" "
                                type="text"
                            />
                        </div>
                        </div>
                        <div class="col-2 ">
                            <div class="input-box pt-1  ">
                                    <button type="submit" id="myButton" class="theme-btn">Send</button>

                                </div>
                        </div>
                    </div>
</form>
                </div>
            </div>
<!-- KaTeX JS -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
            <script>
                
const chat = document.getElementById("chat");
const form = document.getElementById("promptForm");
const input = document.getElementById("prompt");
form.addEventListener("submit", async (e) => {
e.preventDefault();
  const userMessage = input.value;
  appendMessage('user', userMessage)
  console.log(userMessage)
  input.value = "";

   appendMessage("bot", "⏳ Thinking...");

  const response = await query(userMessage);
  console.log(response)
updateLastBotMessage(response);
})

function appendMessage(sender, text) {
  const div = document.createElement("div");
  
if (sender === 'user'){
    div.classList.add('col-lg-12', 'p-2', 'd-flex', 'justify-content-end');
const userText = `
    <div class="shadow-box col-lg-5 p-4 fs-6 lh-base text-break text-wrap">
      ${text}
    </div>
  `;
  div.innerHTML = userText; 
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}
else{
    div.classList.add('col-lg-12', 'p-2','bot');
    const userText = `
<svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
  <rect x="12" y="16" width="40" height="32" rx="16" fill="#3B82F6"/>
  <circle cx="24" cy="32" r="4" fill="white"/>
  <circle cx="40" cy="32" r="4" fill="white"/>
  <path d="M28 40c2 2 6 2 8 0" stroke="white" stroke-width="2" stroke-linecap="round"/>
  <path d="M32 8v8" stroke="#60A5FA" stroke-width="2" stroke-linecap="round"/>
  <path d="M20 20L16 12M44 20L48 12" stroke="#60A5FA" stroke-width="2" stroke-linecap="round"/>
</svg>

  
                        <div
                            class="shadow-box col-lg-5 p-4 fs-6 lh-base text-break text-wrap"
                        >
                            ${text}
                        </div>
                   `
div.innerHTML = userText; // Corrected line
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}
  

  
}
function updateLastBotMessage(newText) {
  const messages = document.querySelectorAll(".bot");
  const lastBot = messages[messages.length - 1];
   const htmlContent = marked.parse(newText);

  lastBot.innerHTML = `
    <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
  <rect x="12" y="16" width="40" height="32" rx="16" fill="#3B82F6"/>
  <circle cx="24" cy="32" r="4" fill="white"/>
  <circle cx="40" cy="32" r="4" fill="white"/>
  <path d="M28 40c2 2 6 2 8 0" stroke="white" stroke-width="2" stroke-linecap="round"/>
  <path d="M32 8v8" stroke="#60A5FA" stroke-width="2" stroke-linecap="round"/>
  <path d="M20 20L16 12M44 20L48 12" stroke="#60A5FA" stroke-width="2" stroke-linecap="round"/>
</svg>

    <div class="shadow-box col-lg-5 p-4 fs-6 lh-base text-break text-wrap">
      ${htmlContent}
    </div>
  `;
  renderMathInElement(htmlContent)
chat.scrollTop = chat.scrollHeight;
}
;
function saveMemory( messages) {
  localStorage.setItem(`memory-best`, JSON.stringify(messages));
}
function getMemory() {
  const data = localStorage.getItem(`memory-best`);
  return data ? JSON.parse(data) : [];
}

async function query(prompt) {
const pastMessages = getMemory();
console.log(pastMessages);
const messages = [
  ...pastMessages,
  { role: "user", content: prompt }
];
if (messages.length > 5) {
  messages = messages.slice(-2); // keep last 30 only
  saveMemory( messages);
}

  const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
    method: "POST",
    headers: {
      "Authorization": "Bearer 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",
      "Content-Type": "application/json",
      "HTTP-Referer": "https://your-app-url.com",
      "X-Title": "OpenRouter Chat App"
    },
    body: JSON.stringify({
      model: "deepseek/deepseek-r1-0528:free",
      messages: messages
    })
  });
  const result = await response.json();
  const reply = result.choices?.[0]?.message;
  saveMemory( [...messages, reply]);
  return result.choices?.[0]?.message?.content || " Sorry, I couldn’t understand that.";

  
}

            </script>
        </div>
        <script src="main.js">
        </script>
    </body>
</html>
